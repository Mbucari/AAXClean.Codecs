name: build-native

on:
  push:
    branches: [master]
    paths:
      - src/ffmpegaac/ffmpegaac.h
      - src/ffmpegaac/AacEncoder.c
      - src/ffmpegaac/AacDecoder.c
      - .github/workflows/build-linux.yml
      - .github/workflows/build-mac.yml
      - .github/workflows/build-win.yml
      - .github/workflows/build-native.yml
 
jobs:
  build-native-linux:
    if: true
    strategy:
      matrix:
        architecture: [x64, arm64]
        include:
          - architecture: x64
            runner: ubuntu-latest
          - architecture: arm64
            runner: ubuntu-24.04-arm
    uses: ./.github/workflows/build-linux.yml
    with:
      runner: ${{ matrix.runner }}
      architecture: ${{ matrix.architecture }}
      
  build-native-mac:
    if: false
    strategy:
      matrix:
        architecture: [x64, arm64]
        include:
          - architecture: x64
            runner: macos-15-intel
          - architecture: arm64
            runner: macos-15
    uses: ./.github/workflows/build-mac.yml
    with:
      runner: ${{ matrix.runner }}
      architecture: ${{ matrix.architecture }}
      ffmpeg-version: 8.0.1
      
  build-native-win:
    if: false
    strategy:
      matrix:
        architecture: [x64, arm64]
        include:
          - architecture: x64
            msystem: MINGW64
            runner: windows-latest
          - architecture: arm64
            msystem: CLANGARM64
            runner: windows-11-arm
    uses: ./.github/workflows/build-win.yml
    with:
      runner: ${{ matrix.runner }}
      msystem: ${{ matrix.msystem }}
      architecture: ${{ matrix.architecture }}
      ffmpeg-version: 8.0.1
